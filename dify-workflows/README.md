# Dify ワークフローDSLファイル

このディレクトリには、DifyにインポートできるワークフローDSL（JSON）ファイルを保管しています。

## 📁 ファイル一覧

### `seo-article-workflow-v1.0.json`
**SEO記事自動執筆システム - メインワークフロー**

#### 概要
競合調査から最終リライトまで、QuestionとAnswerのズレをゼロにする12ステップワークフロー

#### 含まれるノード
1. **Start** - キーワード入力（keyword, persona, article_type）
2. **Search** - 上位10サイト取得（HTTP Request）
3. **Extract** - 本文抽出（Code実行）
4. **Gemini** - クエリ分析・ペルソナ深掘り（Question明確化）
5. **GPT** - 共起語・関連キーワード抽出【心臓部】（Answer準備）
6. **GPT** - 競合分析・差別化戦略（フレッシュネス最優先）
7. **GPT** - アウトライン生成（knowledge_gaps出力）
8. **Loop** - 一次情報追加・知識ギャップ解消（国・公的機関データ優先）
9. **GPT** - 本文生成・10重チェック指示（3,000〜10,000文字）
10. **GPT o3/o4** - ファクトチェック（真実/虚偽/不明瞭判定）
11. **Claude** - 最終リライト・品質向上
12. **End** - SEO記事完成（最終出力）

#### 使用モデル
- **Gemini Pro**: クエリ分析・ペルソナ深掘り
- **GPT-4**: 共起語抽出、競合分析、アウトライン、本文生成
- **GPT o3-mini**: 高精度ファクトチェック
- **Claude 3.5 Sonnet**: 最終リライト

#### 必要な設定
1. **APIキー設定**
   - OpenAI API
   - Google Gemini API
   - Anthropic Claude API

2. **検索API**
   - Search APIエンドポイント設定（変数: `search_api_endpoint`）
   - 例: Google Custom Search API, Brave Search API など

3. **RAGナレッジベース**（オプション）
   - 本文生成・ファクトチェックで使用
   - 法規PDF、社内資料などを登録

#### インポート手順

1. Difyにログイン
2. 「スタジオ」→「ワークフローを作成」
3. 右上メニュー「...」→「DSLファイルをインポート」
4. `seo-article-workflow-v1.0.json` を選択
5. インポート完了後、各ノードの設定を確認
6. 必要に応じてAPIエンドポイントやモデル設定を調整

#### カスタマイズポイント

**プロンプト調整**
- 各LLMノードのプロンプトテンプレートは自由に編集可能
- 業界特有の用語・トーン調整はGeminiノードで設定

**モデル変更**
- GPT-4 → GPT-4 Turbo（コスト削減）
- Claude 3.5 Sonnet → Claude 4（品質向上）
- 用途に応じて自由に変更可能

**Loop回数調整**
- デフォルト: 最大3回
- `loop_primary_info` ノードの `iteration_count` で変更可能

**出力項目追加**
- Endノードの `outputs` に変数を追加
- 例: `meta_description`, `internal_links` など

## 📝 バージョン履歴

### v1.0 (2025-01-XX)
- 初期リリース
- 12ステップワークフロー実装
- Question/Answer概念の統合
- フレッシュネス分析・一次情報収集機能
- 10重チェック指示実装
- GPT o3/o4ファクトチェック対応

## 🔄 アップデート予定

### v1.1（予定）
- [ ] WordPress API連携（自動入稿）
- [ ] メタ情報自動生成強化
- [ ] 内部リンク候補自動抽出

### v2.0（予定）
- [ ] 画像生成・挿入機能
- [ ] 多言語対応
- [ ] A/Bテスト機能統合

## 🐛 既知の問題

1. **検索APIエンドポイントの設定が必要**
   - デフォルトでは `{{search_api_endpoint}}` が未定義
   - 環境変数またはノード設定で指定する必要あり

2. **Loop処理の条件判定**
   - `knowledge_gaps.length > 0` の判定がDifyバージョンによって動作が異なる可能性
   - 必要に応じて条件式を調整

3. **トークン数上限**
   - 長文記事生成時にトークン上限に達する可能性
   - `max_tokens` 設定を調整するか、記事を分割生成

## 💡 Tips

### コスト最適化
- 初稿生成はGPT-4 Turboを使用
- 最終リライトのみClaude 3.5 Sonnetを使用
- ファクトチェックが不要な記事はステップ⑩をスキップ

### 処理時間短縮
- Loop回数を1〜2回に制限
- 並列処理可能なノードは設定変更

### 品質向上
- RAGナレッジベースに業界資料を継続追加
- プロンプトのA/Bテスト実施
- 出力結果をフィードバックに反映

## 🤝 コントリビューション

ワークフローの改善案・バグ報告は以下の方法で：

1. GitHubでIssueを作成
2. 改善版DSLファイルをプルリクエスト
3. Notion上でフィードバック共有

## 📞 サポート

質問・相談は以下まで：
- **リポジトリ**: https://github.com/cross-support/dify
- **連絡先**: cross-support@crosslink.jp.net

---

**© 2025 株式会社クロスリンク**