# Dify ワークフローDSLファイル

このディレクトリには、DifyにインポートできるワークフローDSL（JSON）ファイルを保管しています。

## 📁 ファイル一覧

### `seo-article-workflow-v1.0.json`
**SEO記事自動執筆システム - メインワークフロー**

#### 概要
競合調査から最終リライトまで、QuestionとAnswerのズレをゼロにする12工程（0〜11）ワークフロー

#### 含まれるノード
0. **Keyword Selection** - キーワード選定（人間/Gemini）: CV目標・ペルソナ・記事タイプ決定
1. **Start** - キーワード入力・変数化（keyword, persona, article_type）
2. **Search** - 上位10サイト取得（Gemini/Search API）
3. **Extract** - 本文抽出・データ構造化（Code実行）
4. **Gemini** - クエリ分析・ペルソナ深掘り（Question明確化）
5. **GPT-4/Claude** - 共起語・関連キーワード抽出【心臓部】（Answer準備）
6. **Claude/GPT-4** - 競合分析・差別化戦略（フレッシュネス最優先）
7. **GPT-4/Claude** - アウトライン生成（knowledge_gaps出力）
8. **Gemini** - 一次情報追加・知識ギャップ解消（国・公的機関データ優先）
9. **Claude→GPT-4** - 本文生成・10重チェック指示（3,000〜5,000文字）
   - Claude: 正確で網羅的なドラフト生成
   - GPT-4: 表現のブラッシュアップ
10. **Gemini/GPT o3-mini** - ファクトチェック（真実/虚偽/不明瞭判定）
11. **GPT-4** - 最終リライト・品質向上（文体統一・トーン調整）

#### 使用モデルと役割分担
- **Gemini Pro**: リアルタイム検索、クエリ分析、一次情報収集、ファクトチェック（最新データへのアクセス）
- **GPT-4**: 共起語抽出、アウトライン生成、表現ブラッシュアップ、最終リライト（創造性と文章力）
- **Claude 3.5 Sonnet**: 本文ドラフト生成、競合分析（安定性と正確性）
- **GPT o3-mini**: 高精度ファクトチェック（オプション）

#### 必要な設定
1. **APIキー設定**
   - OpenAI API
   - Google Gemini API
   - Anthropic Claude API

2. **検索API**
   - Search APIエンドポイント設定（変数: `search_api_endpoint`）
   - 例: Google Custom Search API, Brave Search API など

3. **RAGナレッジベース**（オプション）
   - 本文生成・ファクトチェックで使用
   - 法規PDF、社内資料などを登録

#### インポート手順

1. Difyにログイン
2. 「スタジオ」→「ワークフローを作成」
3. 右上メニュー「...」→「DSLファイルをインポート」
4. `seo-article-workflow-v1.0.json` を選択
5. インポート完了後、各ノードの設定を確認
6. 必要に応じてAPIエンドポイントやモデル設定を調整

#### カスタマイズポイント

**プロンプト調整**
- 各LLMノードのプロンプトテンプレートは自由に編集可能
- 業界特有の用語・トーン調整はGeminiノードで設定
- 脳科学・行動経済学の知見を組み込んだプロンプト設計

**モデル変更**
- 各工程で最適なAIを選択（設計書参照）
- GPT-4 → GPT-4 Turbo（コスト削減）
- Claude 3.5 Sonnet → Claude 4（品質向上）
- 工程⑤〜⑦: GPT-4/Claude のいずれかを選択可能
- 工程⑨: Claude→GPT-4 の二段構えを推奨
- 工程⑩: Gemini推奨（最新情報検証）、GPT o3-miniはオプション

**Loop回数調整**
- デフォルト: 最大3回
- `loop_primary_info` ノードの `iteration_count` で変更可能
- 知識ギャップが解消されるまで反復

**出力項目追加**
- Endノードの `outputs` に変数を追加
- 例: `meta_description`, `internal_links` など

## 📝 バージョン履歴

### v1.0 (2025-01-XX)
- 初期リリース
- 12工程（0〜11）ワークフロー実装
- QuestionとAnswerのズレをゼロにする原則の実装
- AI別役割分担の明確化（Gemini/GPT-4/Claude）
- フレッシュネス分析・一次情報収集機能
- 10重チェック指示実装（スキップ厳禁）
- ファクトチェック機能（Gemini推奨、GPT o3-miniオプション）
- 脳科学・行動経済学の知見を組み込んだプロンプト設計

## 🔄 アップデート予定

### v1.1（予定）
- [ ] WordPress API連携（自動入稿）
- [ ] メタ情報自動生成強化
- [ ] 内部リンク候補自動抽出

### v2.0（予定）
- [ ] 画像生成・挿入機能
- [ ] 多言語対応
- [ ] A/Bテスト機能統合

## 🐛 既知の問題

1. **検索APIエンドポイントの設定が必要**
   - デフォルトでは `{{search_api_endpoint}}` が未定義
   - 環境変数またはノード設定で指定する必要あり

2. **Loop処理の条件判定**
   - `knowledge_gaps.length > 0` の判定がDifyバージョンによって動作が異なる可能性
   - 必要に応じて条件式を調整

3. **トークン数上限**
   - 長文記事生成時にトークン上限に達する可能性
   - `max_tokens` 設定を調整するか、記事を分割生成

## 💡 Tips

### コスト最適化
- 工程⑤〜⑦: GPT-4 Turbo使用でコスト削減
- 工程⑨: Claudeでドラフト→GPT-4でブラッシュアップ
- 工程⑩: Gemini推奨（GPT o3-miniはオプション）
- ファクトチェックが不要な記事はステップ⑩をスキップ

### 処理時間短縮
- Loop回数を1〜2回に制限
- 並列処理可能なノードは設定変更
- ただし品質を犠牲にしないこと（QuestionとAnswerのズレをゼロに）

### 品質向上
- RAGナレッジベースに業界資料を継続追加
- プロンプトのA/Bテスト実施
- 出力結果をフィードバックに反映
- 各工程で最適なAIを選択（設計書のモデル比較参照）
- 10重チェック指示の徹底（スキップ厳禁）

## 🤝 コントリビューション

ワークフローの改善案・バグ報告は以下の方法で：

1. GitHubでIssueを作成
2. 改善版DSLファイルをプルリクエスト
3. Notion上でフィードバック共有

## 📞 サポート

質問・相談は以下まで：
- **リポジトリ**: https://github.com/cross-support/dify
- **連絡先**: cross-support@crosslink.jp.net

---

**© 2025 株式会社クロスリンク**